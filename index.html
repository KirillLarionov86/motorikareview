<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Перенаправление...</title>
</head>
<body>
    <h2>Перенаправление...</h2>
    <p id="log">Ждём данные...</p>

    <script>
        function logMessage(message) {
            console.log(message);
            document.getElementById('log').innerHTML += "<br>" + message;
        }

        logMessage("🔵 Начинаем обработку редиректа...");

        // **Выводим полный URL страницы**
        let fullUrl = window.location.href;
        logMessage("🔗 Текущий URL: " + fullUrl);

        // **Функция получения параметров вручную**
        function getQueryParam(param) {
            let result = new RegExp(param + "=([^&]*)", "i").exec(window.location.search);
            return result ? result[1] : null;
        }

        const shopId = getQueryParam("shop_id");
        const employeeId = getQueryParam("employee_id");

        logMessage("🔍 Полученные параметры:");
        logMessage("➡️ shop_id: " + (shopId ? shopId : "❌ Параметр shop_id отсутствует!"));
        logMessage("➡️ employee_id: " + (employeeId ? employeeId : "⚠️ employee_id не указан"));

        // **Правильные ссылки для отзывов**
        const reviewsUrl = {
            "1": "https://yandex.ru/maps/org/petrov_jewelry_watch/202367052946/reviews/",
            "2": "https://yandex.ru/maps/org/petrov_jewelry_watch/98434987667/reviews/",
            "3": "https://yandex.ru/maps/org/petrov_jewelry_watch/197362536275/reviews/"
        };

        let redirectUrl = reviewsUrl[shopId] || "https://yandex.ru/maps/";

        logMessage("📌 Проверяем соответствие shop_id...");
        if (redirectUrl) {
            logMessage("✅ Найдена правильная ссылка: " + redirectUrl);
        } else {
            logMessage("❌ Ошибка! Неизвестный shop_id: " + shopId);
        }

        // **Фиксация перехода в Яндекс.Метрике**
        if (employeeId) {
            logMessage("📊 Фиксируем событие в Яндекс.Метрике...");
            ym(80551024, 'reachGoal', 'review_redirect', { employee_id: employeeId, shop_id: shopId });
        }

        // **Перенаправление**
        logMessage("🚀 Готовимся к редиректу...");
        logMessage("🌍 Открываем: " + redirectUrl);
        
        setTimeout(() => {
            window.location.replace(redirectUrl);
        }, 1000);
    </script>
</body>
</html>
